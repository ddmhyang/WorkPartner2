<UserControl x:Class="WorkPartner.AvatarPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WorkPartner"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <Grid Background="{StaticResource AppBackgroundBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 왼쪽: 현재 아바타 및 색상 꾸미기 -->
        <Border Grid.Column="0" Style="{StaticResource SectionBorderStyle}" Margin="10">
            <StackPanel>
                <TextBlock Text="현재 아바타" Style="{StaticResource SectionHeaderStyle}"/>
                <!-- 캐릭터 미리보기 -->
                <local:CharacterDisplay x:Name="CharacterPreviewControl" Height="200"/>
                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                    <TextBlock x:Name="UsernameTextBlock" Text="사용자" FontWeight="Bold" VerticalAlignment="Center"/>
                    <TextBlock Text=" |  " VerticalAlignment="Center"/>
                    <Image Source="/images/coin.png" Width="16" Height="16" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding TempCoins, StringFormat={}{0:N0}}" VerticalAlignment="Center" Margin="5,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                    <Button Content="저장" Click="SaveButton_Click" Style="{StaticResource ActionButtonStyle}" Margin="5"/>
                    <Button Content="되돌리기" Click="RevertButton_Click" Style="{StaticResource ActionButtonStyle}" Background="Gray" Margin="5"/>
                </StackPanel>

                <Separator Margin="0,20,0,10"/>

                <TextBlock Text="색깔 꾸미기" Style="{StaticResource SectionHeaderStyle}" Margin="0,10,0,10"/>
                <StackPanel>
                    <TextBlock Text="머리 색" Margin="0,0,0,5"/>
                    <xctk:ColorPicker x:Name="HairColorPicker" SelectedColorChanged="ColorPicker_SelectedColorChanged" DisplayColorAndName="True" Tag="{x:Static local:ItemType.HairColor}"/>
                    <TextBlock Text="눈 색" Margin="0,5,0,5"/>
                    <xctk:ColorPicker x:Name="EyeColorPicker" SelectedColorChanged="ColorPicker_SelectedColorChanged" DisplayColorAndName="True" Tag="{x:Static local:ItemType.EyeColor}"/>
                    <TextBlock Text="옷 색" Margin="0,5,0,5"/>
                    <xctk:ColorPicker x:Name="ClothesColorPicker" SelectedColorChanged="ColorPicker_SelectedColorChanged" DisplayColorAndName="True" Tag="{x:Static local:ItemType.ClothesColor}"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- 오른쪽: 옷장 -->
        <DockPanel Grid.Column="1">
            <ListBox x:Name="CategoryListBox" DockPanel.Dock="Top" SelectionChanged="CategoryListBox_SelectionChanged" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding}" Margin="10,5"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="ItemsListView">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type local:DisplayShopItem}">
                            <Button Margin="5" Width="120" Height="120" Click="ItemButton_Click"
                                    BorderBrush="{Binding BorderColor}" BorderThickness="3">
                                <StackPanel>
                                    <Image Source="{Binding ImagePath}" Width="80" Height="80" Stretch="Uniform">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Opacity" Value="1.0"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsOwned}" Value="False">
                                                        <Setter Property="Opacity" Value="0.7"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                    <TextBlock Text="{Binding Name}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                    <TextBlock Text="{Binding Price, StringFormat={}{0:N0} 코인}" 
                                               HorizontalAlignment="Center" FontSize="10"
                                               Visibility="{Binding IsFree, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}"/>
                                </StackPanel>
                            </Button>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </DockPanel>
    </Grid>
</UserControl>

