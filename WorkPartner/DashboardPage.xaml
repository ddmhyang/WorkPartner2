<UserControl x:Class="WorkPartner.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://expression.blend.com/2008" 
             xmlns:local="clr-namespace:WorkPartner"
             mc:Ignorable="d" 
             d:DesignHeight="526" d:DesignWidth="682"
             Loaded="Window_Loaded" IsVisibleChanged="DashboardPage_IsVisibleChanged"
             FontFamily="Pretendard">
    <UserControl.Resources>
        <Style x:Key="RoundSliderStyle" TargetType="Slider">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="1" CornerRadius="1" Background="#C4C4C4" Height="2" />

                            <Track Name="PART_Track" Grid.Row="1">
                                <Track.Thumb>
                                    <Thumb Width="6" Height="6">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse Width="6" Height="6" Fill="White" />
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Canvas x:Name="dashboard" Width="682" Height="526" Background="#FFFFFF">

        <Button Canvas.Left="19" Canvas.Top="40" Width="24" Height="24" 
                Tag="Settings" Click="NavButton_Click" ToolTip="설정" Background="Transparent" BorderBrush="Transparent">
            <Image Source="/images/settings.png" />
        </Button>

        <Button Canvas.Left="54" Canvas.Top="40" Width="24" Height="24"
                Tag="Analysis" Click="NavButton_Click" ToolTip="분석" Background="Transparent" BorderBrush="Transparent">
            <Image Source="/images/bar_chart.png" />
        </Button>

        <TextBlock x:Name="CurrentTaskDisplay" Canvas.Left="186" Canvas.Top="74" 
                   Text="현재 과목" TextAlignment="Center" Foreground="#FF005B8B"
                   FontFamily="Pretendard" FontSize="14" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center"/>

        <TextBlock x:Name="MainTimeDisplay" Canvas.Left="123" Canvas.Top="92" Width="180"
                   Text="00:00:00" TextAlignment="Center" 
                   FontFamily="Pretendard" FontSize="40" FontWeight="SemiBold"/>

        <TextBlock x:Name="SelectedTaskTotalTimeDisplay" Canvas.Left="159" Canvas.Top="145" 
                   Text="오늘의 작업 시간 | 00:00:00" TextAlignment="Center" 
                   FontFamily="Pretendard" FontSize="8" FontWeight="Medium"/>

        <Border Canvas.Left="19" Canvas.Top="173" Width="388" Height="331" 
                BorderBrush="#f0f0f0" BorderThickness="2" CornerRadius="10">
            <Canvas>
                <Grid Canvas.Left="135" Canvas.Top="11" Width="120" Height="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Content="&lt;" Click="PrevDayButton_Click" VerticalAlignment="Center" Background="Transparent" BorderBrush="Transparent" Margin="-9,0,10,0"/>
                    <TextBlock x:Name="CurrentDateDisplay" Text="2025-08-12" VerticalAlignment="Center" FontSize="8" FontFamily= "Pretendard" HorizontalAlignment="Left" Padding= "21, 3, 21, 3" Background="#F0F0F0" FontWeight="SemiBold" Grid.ColumnSpan="2" Margin="5,0,0,0"/>
                    <TextBlock x:Name="CurrentDayDisplay" Text="수" Canvas.Left="220" Canvas.Top="276" FontSize="8" FontWeight="Bold" Grid.Column="1" Margin="85,6,2,4" Width="8" Height="10"/>
                    <Button Grid.Column="2" Content="&gt;" Click="NextDayButton_Click" VerticalAlignment="Center" Background="Transparent" BorderBrush="Transparent"/>
                </Grid>

                <StackPanel Orientation="Horizontal" Canvas.Left="296" Canvas.Top="12">
                    <Border CornerRadius="7.5" BorderBrush="#FF2195F2" BorderThickness="0" Background="#FF2195F2">
                        <Button Content="+ 기록 직접 추가" Click="AddManualLogButton_Click" Height="17" Background="#00000000" Width="69" FontSize="8" BorderBrush="#00000000" Foreground="White" BorderThickness="1" RenderTransformOrigin="0.5,0.5">
                            <Button.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <SkewTransform/>
                                    <RotateTransform/>
                                    <TranslateTransform X="0"/>
                                </TransformGroup>
                            </Button.RenderTransform>
                        </Button>
                    </Border>
                </StackPanel>

                <Border Canvas.Left="0" Canvas.Top="38" Width="262" Height="264">
                    <ScrollViewer VerticalScrollBarVisibility="Hidden" HorizontalScrollBarVisibility="Disabled">
                        <Grid x:Name="SelectionCanvas" Background="Transparent"
              MouseLeftButtonDown="SelectionCanvas_MouseLeftButtonDown"
              MouseMove="SelectionCanvas_MouseMove" 
              MouseLeftButtonUp="SelectionCanvas_MouseLeftButtonUp">
                            <StackPanel x:Name="TimeTableContainer" Orientation="Vertical"/>
                        </Grid>
                    </ScrollViewer>
                </Border>

                <Border Canvas.Left="272" Canvas.Top="38" Width="95" Height="171" 
        BorderBrush="#E0E0E0" BorderThickness="1" Background="#f0f0f0" CornerRadius="5"
        Cursor="Hand" MouseLeftButtonDown="PinnedMemo_MouseLeftButtonDown"
        ToolTip="클릭해서 메모장 열기">
                    <Grid Margin="10">
                        <StackPanel x:Name="PinnedMemoView">
                            <TextBlock x:Name="PinnedMemoContent" 
                       TextTrimming="CharacterEllipsis" 
                       TextWrapping="Wrap"
                       MaxHeight="150"
                       Foreground="#000000" FontSize="10"/>
                        </StackPanel>
                        <TextBlock x:Name="NoPinnedMemoText" 
                   Text="작성된 &#x0a;메모가 &#x0a;없습니다."
                   TextAlignment="Center"
                   VerticalAlignment="Center"
                   Foreground="#939393"
                   Visibility="Collapsed" FontSize="10"/>
                    </Grid>
                </Border>

                <Border Canvas.Left="272" Canvas.Top="215" Width="95" Height="90">
                    <StackPanel>
                        <Border CornerRadius="2" Background="#FF345080">
                            <StackPanel Orientation="Horizontal" Height="21">
                                <Image Source="/path/wave.png" Width="15" Height="15" Margin="0,0,5,0" />
                                <Slider x:Name="waveSlider" Width="56" Height="6" Value="0" Minimum="0" Maximum="1" Style="{StaticResource RoundSliderStyle}" Background="White" />
                            </StackPanel>
                        </Border>

                        <Border CornerRadius="2" Background="#FF5DB15D" Margin="0,1,0,0">
                            <StackPanel Orientation="Horizontal" Height="21">
                                <Image Source="/path/forest.png" Width="15" Height="15" Margin="0,0,5,0" />
                                <Slider x:Name="forestSlider" Width="56" Height="6" Value="0" Minimum="0" Maximum="1" Style="{StaticResource RoundSliderStyle}" Background="White" />
                            </StackPanel>
                        </Border>

                        <Border CornerRadius="2" Background="#FFD9D9D9" Margin="0,1,0,0">
                            <StackPanel Orientation="Horizontal" Height="21">
                                <Image Source="/path/rain.png" Width="15" Height="15" Margin="0,0,5,0" />
                                <Slider x:Name="rainSlider" Width="56" Height="6" Value="0" Minimum="0" Maximum="1" Style="{StaticResource RoundSliderStyle}" Background="White" />
                            </StackPanel>
                        </Border>

                        <Border CornerRadius="2" Background="#FFF27821" Margin="0,1,0,0">
                            <StackPanel Orientation="Horizontal" Height="21">
                                <Image Source="/path/fire.png" Width="15" Height="15" Margin="0,0,5,0" />
                                <Slider x:Name="campfireSlider" Width="56" Height="6" Value="1" Minimum="0" Maximum="1" Style="{StaticResource RoundSliderStyle}" Background="White" ValueChanged="campfireSlider_ValueChanged_1" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </Canvas>
        </Border>

        <Border Canvas.Left="417" Canvas.Top="40" Width="247" Height="123" 
                BorderBrush="Black" BorderThickness="1" CornerRadius="10">
            <Grid>
                <local:CharacterDisplay x:Name="CharacterPreview" />
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10">
                    <TextBlock x:Name="UsernameDisplay" Text="User" FontWeight="Bold" Margin="0,0,10,0"/>
                    <Image Source="/images/coin.png" Width="16" Height="16"/>
                    <TextBlock x:Name="CoinDisplay" Text="0"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Canvas.Left="417" Canvas.Top="173" Width="247" Height="145" 
                BorderBrush="#E8E8E8" BorderThickness="1" CornerRadius="10" Background="#E8E8E8">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="과목" VerticalAlignment="Center" Margin="16,8,0,0"/>
                <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal">
                    <TextBox x:Name="TaskInput" KeyDown="TaskInput_KeyDown" Width="180"/>
                    <Button Width="11" 
        Height="11"
        Background="White"
        BorderThickness="0"
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        Foreground="#FFE8E8E8"
        FontSize="8"
        Click="Button_Click"
        Content="+">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border CornerRadius="11"
                    Background="{TemplateBinding Background}"
                    BorderBrush="Transparent"
                    BorderThickness="0">
                                    <ContentPresenter HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                </StackPanel>
                <ListBox x:Name="TaskListBox" ItemsSource="{Binding TaskItems}" Background="Transparent" />
            </DockPanel>
        </Border>

        <Border Canvas.Left="417" Canvas.Top="327" Width="247" Height="177" 
                BorderBrush="Black" BorderThickness="1" CornerRadius="10">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="오늘의 할일"/>
                <StackPanel DockPanel.Dock="Bottom">
                    <TextBox x:Name="TodoInput" KeyDown="TodoInput_KeyDown"/>
                    <Button Content="할일 추가" Click="AddTodoButton_Click"/>
                </StackPanel>
                <TreeView x:Name="TodoTreeView" ItemsSource="{Binding FilteredTodoItems}"/>
            </DockPanel>
        </Border>

        <Border x:Name="SessionReviewPanel" Visibility="Collapsed" Background="#AA000000"
                Canvas.Left="0" Canvas.Top="0" Width="682" Height="526">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="방금 세션은 얼마나 집중했나요?" Foreground="White" FontSize="18" TextAlignment="Center" Margin="10"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="1점" Tag="1" Click="RateSessionButton_Click" Margin="5"/>
                    <Button Content="2점" Tag="2" Click="RateSessionButton_Click" Margin="5"/>
                    <Button Content="3점" Tag="3" Click="RateSessionButton_Click" Margin="5"/>
                    <Button Content="4점" Tag="4" Click="RateSessionButton_Click" Margin="5"/>
                    <Button Content="5점" Tag="5" Click="RateSessionButton_Click" Margin="5"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <TextBlock x:Name="AiSuggestionTextBlock" Text="" Canvas.Left="10" Canvas.Top="500" Visibility="Collapsed"/>

    </Canvas>
    
</UserControl>
